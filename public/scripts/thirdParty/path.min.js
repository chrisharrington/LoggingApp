var Path={version:"0.8.4",map:function(a){if(Path.routes.defined.hasOwnProperty(a)){return Path.routes.defined[a]}else{return new Path.core.route(a)}},root:function(a){Path.routes.root=a},rescue:function(a){Path.routes.rescue=a},history:{initial:{},pushState:function(a,c,b){if(Path.history.supported){if(Path.dispatch(b)){history.pushState(a,c,b)}}else{if(Path.history.fallback){window.location.hash="#"+b}}},popState:function(b){var a=!Path.history.initial.popped&&location.href==Path.history.initial.URL;Path.history.initial.popped=true;if(a){return}Path.dispatch(document.location.pathname)},listen:function(a){Path.history.supported=!!(window.history&&window.history.pushState);Path.history.fallback=a;if(Path.history.supported){Path.history.initial.popped=("state" in window.history),Path.history.initial.URL=location.href;window.onpopstate=Path.history.popState}else{if(Path.history.fallback){for(route in Path.routes.defined){if(route.charAt(0)!="#"){Path.routes.defined["#"+route]=Path.routes.defined[route];Path.routes.defined["#"+route].path="#"+route}}Path.listen()}}}},match:function(m,l){var k=null,f,h,e,d,b;for(k in Path.routes.defined){if(k!==null&&k!==undefined){var c={};k=Path.routes.defined[k];f=k.partition();for(d=0;d<f.length;d++){h=f[d];b=m;if(h.search(/:/)>0){var a=h.split("/"),g=b.split("/");if(a.length==g.length){for(var e=0;e<a.length;e++){if(a[e].charAt(0)===":"){c[a[e].replace(/:/,"")]=g[e];g[e]=a[e]}}}b=g.join("/")}if(h===b){if(l){k.params=c}return k}}}}return null},dispatch:function(a){var b,c;if(Path.routes.current!==a){Path.routes.previous=Path.routes.current;Path.routes.current=a;c=Path.match(a,true);if(Path.routes.previous){b=Path.match(Path.routes.previous);if(b!==null&&b.do_exit!==null){b.do_exit()}}if(c!==null){c.run();return true}else{if(Path.routes.rescue!==null){Path.routes.rescue()}}}},listen:function(){var a=function(){Path.dispatch(location.hash)};if(location.hash===""){if(Path.routes.root!==null){location.hash=Path.routes.root}}if("onhashchange" in window&&(!document.documentMode||document.documentMode>=8)){window.onhashchange=a}else{setInterval(a,50)}if(location.hash!==""){Path.dispatch(location.hash)}},core:{route:function(a){this.path=a;this.action=null;this.do_enter=[];this.do_exit=null;this.params={};Path.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};Path.core.route.prototype={to:function(a){this.action=a;return this},enter:function(a){if(a instanceof Array){this.do_enter=this.do_enter.concat(a)}else{this.do_enter.push(a)}return this},exit:function(a){this.do_exit=a;return this},partition:function(){var d=[],a=[],c=/\(([^}]+?)\)/g,e,b;while(e=c.exec(this.path)){d.push(e[1])}a.push(this.path.split("(")[0]);for(b=0;b<d.length;b++){a.push(a[a.length-1]+d[b])}return a},run:function(){var b=false,c,a,d;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")){if(Path.routes.defined[this.path].do_enter.length>0){for(c=0;c<Path.routes.defined[this.path].do_enter.length;c++){a=Path.routes.defined[this.path].do_enter[c].apply(this,null);if(a===false){b=true;break}}}}if(!b){Path.routes.defined[this.path].action()}}};